{% extends "base.html" %}

{% block head %}
    {{ super() }}
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://clyp.codesft.dev/">
    <meta property="og:title" content="Clyp ‚Äì Modern Python-like Language">
    <meta property="og:description" content="A clean, expressive programming language that transpiles to Python. Enjoy static-like typing, simplified syntax, and seamless Python interoperability.">
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://clyp.codesft.dev/">
    <meta name="twitter:title" content="Clyp ‚Äì Modern Python-like Language">
    <meta name="twitter:description" content="A clean, expressive programming language that transpiles to Python. Enjoy static-like typing, simplified syntax, and seamless Python interoperability.">
    
    <style>
    /* Examples Section Styles */
    .examples-section { 
        background: var(--bg-secondary); 
        padding: 4rem 0; 
    }
    .examples-container { 
        max-width: 1200px; 
        margin: 0 auto; 
        padding: 0 1.5rem; 
    }
    .section-header {
        text-align: center;
        margin-bottom: 3rem;
    }
    .section-header h2 {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        color: var(--primary-color);
    }
    .section-header p {
        font-size: 1.1rem;
        color: var(--text-secondary);
        max-width: 600px;
        margin: 0 auto;
    }
    .examples-grid { 
        display: grid; 
        grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); 
        gap: 2rem; 
        margin-bottom: 4rem; 
    }
    .example-card { 
        background: var(--bg-card); 
        border-radius: 1rem; 
        box-shadow: var(--shadow-md); 
        overflow: hidden; 
        transition: transform 0.2s ease;
    }
    .example-card:hover {
        transform: translateY(-2px);
    }
    .example-header { 
        padding: 1.5rem; 
        background: var(--bg-tertiary);
    }
    .example-header h3 { 
        font-size: 1.3rem; 
        margin-bottom: 0.5rem; 
        color: var(--text-primary);
    }
    .example-header p { 
        color: var(--text-secondary); 
        margin: 0; 
    }
    
    /* Code Playground */
    .code-playground {
        background: var(--bg-card);
        border-radius: 1rem;
        padding: 2rem;
        margin: 3rem 0;
        box-shadow: var(--shadow-md);
    }
    .code-playground h3 {
        font-size: 1.8rem;
        margin-bottom: 0.5rem;
        color: var(--primary-color);
    }
    .code-playground p {
        color: var(--text-secondary);
        margin-bottom: 2rem;
    }
    .playground-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        height: 400px;
    }
    .editor-section, .output-section {
        display: flex;
        flex-direction: column;
        border: 1px solid var(--border-color);
        border-radius: 0.5rem;
        overflow: hidden;
    }
    .editor-header, .output-header {
        background: var(--bg-tertiary);
        padding: 0.75rem 1rem;
        font-weight: 600;
        color: var(--text-primary);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .run-btn {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 0.25rem;
        cursor: pointer;
        font-size: 0.9rem;
        transition: background 0.2s ease;
    }
    .run-btn:hover {
        background: var(--primary-hover);
    }
    #code-editor {
        flex: 1;
        border: none;
        padding: 1rem;
        font-family: var(--font-mono);
        font-size: 0.9rem;
        background: var(--code-bg);
        color: var(--code-text);
        resize: none;
        outline: none;
        min-height: 300px;
    }
    .output-content {
        flex: 1;
        padding: 1rem;
        background: var(--code-bg);
        color: var(--code-text);
        font-family: var(--font-mono);
        font-size: 0.9rem;
        overflow-y: auto;
    }
    .output-line {
        margin-bottom: 0.5rem;
    }
    
    /* Next Steps */
    .next-steps {
        margin-top: 3rem;
    }
    .next-steps h3 {
        text-align: center;
        font-size: 1.8rem;
        margin-bottom: 2rem;
        color: var(--primary-color);
    }
    .steps-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
    }
    .step-card {
        background: var(--bg-tertiary);
        padding: 1.5rem;
        border-radius: 0.75rem;
        text-align: center;
        transition: transform 0.2s ease;
    }
    .step-card:hover {
        transform: translateY(-2px);
    }
    .step-icon {
        font-size: 2rem;
        margin-bottom: 1rem;
    }
    .step-card h4 {
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
        color: var(--text-primary);
    }
    .step-card p {
        color: var(--text-secondary);
        margin-bottom: 1rem;
        font-size: 0.95rem;
    }
    .step-link {
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 600;
        transition: color 0.2s ease;
    }
    .step-link:hover {
        color: var(--primary-hover);
    }
    
    /* What's Happening Section */
    .whats-happening-section { 
        background: var(--bg-secondary); 
        padding: 4rem 0; 
    }
    .whats-happening-container { 
        max-width: 1200px; 
        margin: 0 auto; 
        padding: 0 1.5rem; 
    }
    .whats-happening-flex { 
        display: flex; 
        gap: 2.5rem; 
        flex-wrap: wrap; 
        margin-top: 2rem;
    }
    .whats-happening-card { 
        background: var(--bg-card); 
        border-radius: 1rem; 
        box-shadow: var(--shadow-md); 
        flex: 1 1 350px; 
        padding: 2rem; 
        min-width: 320px; 
    }
    .whats-happening-card h3 { 
        font-size: 1.4rem; 
        margin-bottom: 1.5rem; 
        color: var(--primary-color); 
    }
    .wh-list { 
        display: flex; 
        flex-direction: column; 
        gap: 1.5rem; 
    }
    .wh-item { 
        border-left: 4px solid var(--primary-color); 
        background: var(--bg-tertiary); 
        border-radius: 0.5rem; 
        padding: 1rem 1.2rem; 
        box-shadow: var(--shadow-sm); 
    }
    .wh-title { 
        font-weight: 600; 
        font-size: 1.1rem; 
        margin-bottom: 0.3rem; 
    }
    .wh-title a { 
        color: var(--text-primary); 
        text-decoration: none; 
    }
    .wh-title a:hover { 
        color: var(--primary-color); 
        text-decoration: underline; 
    }
    .wh-meta { 
        color: var(--text-secondary); 
        font-size: 0.95rem; 
        margin-bottom: 0.5rem; 
    }
    .wh-body { 
        color: var(--text-secondary); 
        font-size: 0.98rem; 
    }
    .wh-loading, .wh-empty { 
        color: var(--text-light); 
        text-align: center; 
        padding: 1.5rem 0; 
    }
    .release-tag { 
        display: inline-block; 
        padding: 0.2em 0.6em; 
        border-radius: 0.4em; 
        font-size: 0.85em; 
        margin-left: 0.5em; 
        vertical-align: middle; 
    }
    
    /* Responsive Design */
    @media (max-width: 900px) { 
        .whats-happening-flex { 
            flex-direction: column; 
            gap: 2rem; 
        }
        .examples-grid {
            grid-template-columns: 1fr;
        }
        .playground-container {
            grid-template-columns: 1fr;
            height: auto;
        }
    }
    @media (max-width: 600px) {
        .section-header h2 {
            font-size: 2rem;
        }
        .examples-grid {
            gap: 1.5rem;
        }
        .example-card {
            min-width: auto;
        }
    }
    </style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section id="home" class="hero">
    <div class="hero-container">
        <div class="hero-content">
            <div class="hero-text">
                <h1 class="hero-title">
                    <span class="gradient-text">Clyp</span>
                    <br>Modern Python-like Language
                </h1>
                <p class="hero-subtitle">
                    A clean, expressive programming language that transpiles to Python. 
                    Enjoy static-like typing, simplified syntax, and seamless Python interoperability.
                </p>
                <div class="hero-actions">
                    <a href="#get-started" class="btn btn-primary">Get Started</a>
                    <a href="#examples" class="btn btn-secondary">View Examples</a>
                </div>
            </div>
            <div class="hero-code">
                <div class="code-window">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="dot red"></span>
                            <span class="dot yellow"></span>
                            <span class="dot green"></span>
                        </div>
                        <span class="code-title">hello_world.clyp</span>
                    </div>
                    <div class="code-content">
                        {{ examples.hello_world.highlighted_code | safe }}
                    </div>
                </div>
            </div>
        </div>
        <!-- Add centered TinyLaunch badge under the buttons and code example -->
        <div class="hero-badge" style="text-align:center; margin-top:1rem;">
            <a href="https://tinylaunch.com" target="_blank" rel="noopener noreferrer" aria-label="TinyLaunch">
                <img src="https://tinylaunch.com/tinylaunch_badge_launching_soon.svg" alt="TinyLaunch Badge" style="width:202px; height:auto;" />
            </a>
        </div>
    </div>
</section>

<!-- Live Stats Section -->
<section class="live-stats-section">
    <div class="live-stats-container">
        <div class="live-stats-grid">
            <div class="live-stat" id="pypi-downloads">
                <div class="stat-label">PyPI Downloads</div>
                <div class="stat-value" id="pypi-downloads-value">...</div>
            </div>
            <div class="live-stat" id="github-stars">
                <div class="stat-label">GitHub Stars</div>
                <div class="stat-value" id="github-stars-value">...</div>
            </div>
            <div class="live-stat" id="github-commits">
                <div class="stat-label">GitHub Commits</div>
                <div class="stat-value" id="github-commits-value">...</div>
            </div>
        </div>
    </div>
</section>

<!-- Features Section -->
<section class="features">
    <div class="features-container">
        <h2 class="section-title">Why Choose Clyp?</h2>
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">üéØ</div>
                <h3>Static-like Typing</h3>
                <p>Variables are declared with their types, providing clarity and catching errors early in development.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">‚ú®</div>
                <h3>Clean Syntax</h3>
                <p>Uses familiar C-like syntax with {} for blocks and ; for statements, making code more readable.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üêç</div>
                <h3>Python Interop</h3>
                <p>Seamlessly use Python libraries and functions. Clyp transpiles directly to Python code.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üìö</div>
                <h3>Rich Standard Library</h3>
                <p>Built-in functions for common tasks like file I/O, HTTP requests, and data manipulation.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">‚ö°</div>
                <h3>Pipeline Operator</h3>
                <p>Elegant data transformation with the pipeline operator |> for functional programming patterns.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üîß</div>
                <h3>Modern Features</h3>
                <p>Classes, conditionals, loops, and advanced language constructs in an intuitive package.</p>
            </div>
        </div>
    </div>
</section>

<!-- Code Examples Section -->
<section class="code-examples">
    <div class="examples-container">
        <h2 class="section-title">See Clyp in Action</h2>
        <div class="examples-tabs">
            <button class="tab-button active" data-tab="basic">Basic Syntax</button>
            <button class="tab-button" data-tab="structures">Data Structures</button>
            <button class="tab-button" data-tab="advanced">Advanced</button>
        </div>
        
        <div class="tab-content active" id="basic">
            <div class="code-example">
                <div class="example-header">
                    <h3>{{ examples.hello_world.title }}</h3>
                    <p>{{ examples.hello_world.description }}</p>
                </div>
                <div class="code-window">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="dot red"></span>
                            <span class="dot yellow"></span>
                            <span class="dot green"></span>
                        </div>
                        <span class="code-title">hello_world.clyp</span>
                    </div>
                    <div class="code-content">
                        {{ examples.hello_world.highlighted_code | safe }}
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="structures">
            <div class="code-example">
                <div class="example-header">
                    <h3>{{ examples.data_structures.title }}</h3>
                    <p>{{ examples.data_structures.description }}</p>
                </div>
                <div class="code-window">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="dot red"></span>
                            <span class="dot yellow"></span>
                            <span class="dot green"></span>
                        </div>
                        <span class="code-title">data_structures.clyp</span>
                    </div>
                    <div class="code-content">
                        {{ examples.data_structures.highlighted_code | safe }}
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="advanced">
            <div class="code-example">
                <div class="example-header">
                    <h3>{{ examples.advanced.title }}</h3>
                    <p>{{ examples.advanced.description }}</p>
                </div>
                <div class="code-window">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="dot red"></span>
                            <span class="dot yellow"></span>
                            <span class="dot green"></span>
                        </div>
                        <span class="code-title">advanced_features.clyp</span>
                    </div>
                    <div class="code-content">
                        {{ examples.advanced.highlighted_code | safe }}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Installation Section -->
<section id="get-started" class="installation">
    <div class="install-container">
        <h2 class="section-title">Get Started</h2>
        <div class="install-columns" style="display: flex; gap: 2rem; justify-content: center; flex-wrap: wrap; margin: 2.5rem 0;">
            <!-- Windows Column -->
            <div class="install-col" style="flex:1 1 260px; min-width:260px; max-width:350px; background: var(--bg-card); border-radius: var(--radius-lg); box-shadow: var(--shadow-sm); border: 1px solid var(--border-color); padding: 2rem 1.5rem; display: flex; flex-direction: column; align-items: center; margin-bottom: 1.5rem;">
                <div style="font-size:2.2rem; margin-bottom:0.7rem;">ü™ü</div>
                <h3 style="font-size:1.25rem; font-weight:700; margin-bottom:0.7rem; color:var(--primary-color);">Windows</h3>
                <p style="color:var(--text-secondary); text-align:center; margin-bottom:1.2rem;">Download the official installer for Windows 10/11 (64-bit).</p>
                <a style="text-align:center" href="https://github.com/clyplang/clypinstaller/releases/latest/download/install.exe" class="btn btn-primary" style="width:100%; text-align:center; font-size:1.08rem; margin-bottom:0.7rem;" download>
                    Download Installer
                </a>
                <div style="font-size:0.95rem; color:var(--text-light); margin-top:0.5rem; text-align:center;">
                    <span>Just run the installer and follow the prompts.</span>
                </div>
            </div>
            <!-- Other Platforms Column -->
            <div class="install-col" style="flex:1 1 260px; min-width:260px; max-width:350px; background: var(--bg-card); border-radius: var(--radius-lg); box-shadow: var(--shadow-sm); border: 1px solid var(--border-color); padding: 2rem 1.5rem; display: flex; flex-direction: column; align-items: center; margin-bottom: 1.5rem;">
                <div style="font-size:2.2rem; margin-bottom:0.7rem;">üêßüçéüíª</div>
                <h3 style="font-size:1.25rem; font-weight:700; margin-bottom:0.7rem; color:var(--primary-color);">Other Platforms</h3>
                <p style="color:var(--text-secondary); text-align:center; margin-bottom:1.2rem;">Install via <b>pip</b> on Linux, macOS, or WSL:</p>
                <div class="code-block" style="width:100%; display:flex; align-items:center; background:var(--code-bg); color:var(--code-text); border-radius:var(--radius-md); padding:0.7rem 1rem; margin-bottom:0.7rem;">
                    <code id="pip-install-cmd" style="font-size:1rem; background:none; color:inherit; flex:1;">pip install clyp</code>
                </div>
                <div style="font-size:0.95rem; color:var(--text-light); margin-top:0.5rem; text-align:center;">
                    <span>Requires Python 3.8+ and pip.</span>
                </div>
            </div>
        </div>
        <div class="install-cta">
            <p>Ready to dive deeper?</p>
            <a href="#examples" class="btn btn-primary">Explore Examples</a>
        </div>
    </div>
</section>

<!-- Comprehensive Examples Section -->
<section id="examples" class="examples-section">
    <div class="examples-container">
        <div class="section-header">
            <h2 class="section-title">Comprehensive Examples</h2>
            <p>Explore the power and elegance of Clyp through these detailed code examples</p>
        </div>
        
        <div class="examples-grid">
            {% for key, example in examples.items() %}
            <div class="example-card">
                <div class="example-header">
                    <h3>{{ example.title }}</h3>
                    <p>{{ example.description }}</p>
                </div>
                <div class="code-window">
                    <div class="code-header">
                        <div class="code-dots">
                            <span class="dot red"></span>
                            <span class="dot yellow"></span>
                            <span class="dot green"></span>
                        </div>
                        <span class="code-title">{{ key }}.clyp</span>
                        <button class="copy-code-btn" onclick="copyCode('{{ key }}')">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                            </svg>
                            Copy
                        </button>
                    </div>
                    <div class="code-content">
                        <div class="code-raw" id="{{ key }}-raw" style="display: none;">{{ example.code }}</div>
                        {{ example.highlighted_code | safe }}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- Interactive Code Editor -->
        <div class="code-playground">
            <h3>Try Clyp Online</h3>
            <p>Write and test Clyp code directly in your browser</p>
            <div class="playground-container">
                <div class="editor-section">
                    <div class="editor-header">
                        <span>Code Editor</span>
                        <button onclick="runCode()" class="run-btn">‚ñ∂ Run</button>
                    </div>
                    <textarea id="code-editor" placeholder="# Write your Clyp code here
str greeting = &quot;Hello, World!&quot;;
print(greeting);">
# Write your Clyp code here
str greeting = "Hello, World!";
print(greeting);</textarea>
                </div>
                <div class="output-section">
                    <div class="output-header">Output</div>
                    <div id="output" class="output-content">
                        <div class="output-line">Ready to run your code...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Next Steps -->
        <div class="next-steps">
            <h3>What's Next?</h3>
            <div class="steps-grid">
                <div class="step-card">
                    <div class="step-icon">üìñ</div>
                    <h4>Read the Documentation</h4>
                    <p>Learn about Clyp's syntax, features, and standard library</p>
                    <a href="https://clypdocs.codesft.dev" class="step-link">View Docs ‚Üí</a>
                </div>
                <div class="step-card">
                    <div class="step-icon">üõ†Ô∏è</div>
                    <h4>Contribute</h4>
                    <p>Help improve Clyp by contributing to the project</p>
                    <a href="https://github.com/CodeSoftGit/clyp" target="_blank" class="step-link">GitHub ‚Üí</a>
                </div>
                <div class="step-card">
                    <div class="step-icon">üí¨</div>
                    <h4>Join the Community</h4>
                    <p>Connect with other Clyp developers and get help</p>
                    <a href="#whats-happening" class="step-link">What's Happening ‚Üí</a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- What's Happening Section -->
<section id="whats-happening" class="whats-happening-section">
    <div class="whats-happening-container">
        <div class="section-header">
            <h2 class="section-title">What's Happening</h2>
            <p>Stay up to date with the latest releases and development activity</p>
        </div>
        
        <div class="whats-happening-flex">
            <div class="whats-happening-card">
                <h3>üöÄ Recent Releases</h3>
                <div id="releases-list" class="wh-list loading">
                    <div class="wh-loading">Loading releases‚Ä¶</div>
                </div>
            </div>
            <div class="whats-happening-card">
                <h3>üîÄ Open Pull Requests</h3>
                <div id="prs-list" class="wh-list loading">
                    <div class="wh-loading">Loading pull requests‚Ä¶</div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
// Tab functionality
document.addEventListener('DOMContentLoaded', function() {
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabButtons.forEach(button => {
        button.addEventListener('click', function() {
            const tabId = this.getAttribute('data-tab');
            
            // Remove active class from all buttons and contents
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Add active class to clicked button and corresponding content
            this.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        });
    });
});

// Copy to clipboard function (updated for button feedback)
function copyToClipboard(text, btn) {
    navigator.clipboard.writeText(text).then(function() {
        const originalText = btn.textContent;
        btn.textContent = 'Copied!';
        btn.classList.add('copied');
        setTimeout(() => {
            btn.textContent = originalText;
            btn.classList.remove('copied');
        }, 2000);
    });
}

// Copy code functionality for examples
function copyCode(exampleKey) {
    const codeElement = document.getElementById(exampleKey + '-raw');
    const code = codeElement.textContent;
    
    navigator.clipboard.writeText(code).then(function() {
        const btn = event.target.closest('.copy-code-btn');
        const originalHTML = btn.innerHTML;
        btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg> Copied!';
        btn.classList.add('copied');
        
        setTimeout(() => {
            btn.innerHTML = originalHTML;
            btn.classList.remove('copied');
        }, 2000);
    }).catch(function() {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = code;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        
        const btn = event.target.closest('.copy-code-btn');
        const originalHTML = btn.innerHTML;
        btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg> Copied!';
        btn.classList.add('copied');
        
        setTimeout(() => {
            btn.innerHTML = originalHTML;
            btn.classList.remove('copied');
        }, 2000);
    });
}

// Code playground functionality
function runCode() {
    const code = document.getElementById('code-editor').value;
    const output = document.getElementById('output');
    
    // Simple simulation of code execution
    output.innerHTML = '<div class="output-line">Running code...</div>';
    
    setTimeout(() => {
        // Extract print statements and simulate output
        const lines = code.split('\n');
        const results = [];
        
        for (const line of lines) {
            const trimmed = line.trim();
            if (trimmed.startsWith('print(')) {
                const match = trimmed.match(/print\((.*)\);?$/);
                if (match) {
                    const content = match[1].replace(/"/g, '').replace(/'/g, '');
                    results.push(content);
                }
            }
        }
        
        if (results.length > 0) {
            output.innerHTML = results.map(result => `<div class="output-line">${result}</div>`).join('');
        } else {
            output.innerHTML = '<div class="output-line">No output</div>';
        }
    }, 500);
}

// Auto-resize textarea
document.addEventListener('DOMContentLoaded', function() {
    const editor = document.getElementById('code-editor');
    if (editor) {
        editor.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = this.scrollHeight + 'px';
        });
    }
});

// Live Stats Fetching (server-side API)
async function updateLiveStats() {
    fetch('/api/live_stats')
        .then(r => r.json())
        .then(stats => {
            document.getElementById('pypi-downloads-value').textContent = stats.pypi_downloads || 'N/A';
            document.getElementById('github-stars-value').textContent = stats.github_stars || 'N/A';
            document.getElementById('github-commits-value').textContent = stats.github_commits || 'N/A';
        })
        .catch(() => {
            document.getElementById('pypi-downloads-value').textContent = 'N/A';
            document.getElementById('github-stars-value').textContent = 'N/A';
            document.getElementById('github-commits-value').textContent = 'N/A';
        });
}

// What's Happening functionality
async function fetchGitHub(url) {
    const resp = await fetch(url, {headers: { 'Accept': 'application/vnd.github+json' }});
    if (!resp.ok) return [];
    return await resp.json();
}

function formatDate(dateStr) {
    const d = new Date(dateStr);
    return d.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' });
}

function getReleaseType(name) {
    const n = name.toLowerCase();
    if (/alpha/.test(n)) return 'alpha';
    if (/beta/.test(n)) return 'beta';
    if (/rc(\d*)|release candidate/.test(n)) return 'rc';
    return 'release';
}

function formatReleaseName(name) {
    let base = name;
    base = base.replace(/[- ]?(alpha|beta|rc\d*|rc|release candidate( \d*)?)/i, '').trim();
    base = base.replace(/[- ]+$/, '').replace(/^[- ]+/, '');
    return base;
}

function getTagColor(type) {
    if (type === 'alpha') return '#ff6b6b';
    if (type === 'beta') return '#45b7d1';
    if (type === 'rc') return '#ffd600';
    return '#4ecdc4';
}

function renderReleaseTag(type, label) {
    const color = getTagColor(type);
    return `<span class="release-tag" style="background:${color};color:#fff;border-radius:0.4em;padding:0.1em 0.6em;font-size:0.85em;margin-left:0.5em;vertical-align:middle;">${label}</span>`;
}

function getReleasePageUrl(r) {
    let version = (r.tag_name || r.name || '').replace(/^v/, '');
    return `/release/${version}`;
}

async function loadReleases() {
    const releases = await fetchGitHub('https://api.github.com/repos/CodeSoftGit/clyp/releases');
    const el = document.getElementById('releases-list');
    el.classList.remove('loading');
    if (!releases.length) {
        el.innerHTML = '<div class="wh-empty">No releases found.</div>';
        return;
    }
    el.innerHTML = releases.slice(0, 5).map(r => {
        const type = getReleaseType(r.name || r.tag_name);
        const label = type === 'alpha' ? 'Alpha' : type === 'beta' ? 'Beta' : type === 'rc' ? 'Release Candidate' : 'Release';
        const formatted = formatReleaseName(r.name || r.tag_name);
        const tag = renderReleaseTag(type, label);
        const releasePageUrl = getReleasePageUrl(r);
        return `
        <div class="wh-item">
            <div class="wh-title"><a href="${releasePageUrl}">${formatted}${tag}</a></div>
            <div class="wh-meta">Published <span>${formatDate(r.published_at)}</span></div>
            <div class="wh-body">${r.body ? r.body.substring(0, 180).replace(/\n/g, ' ') + (r.body.length > 180 ? '‚Ä¶' : '') : ''}</div>
        </div>
        `;
    }).join('');
}

async function loadPRs() {
    const prs = await fetchGitHub('https://api.github.com/repos/CodeSoftGit/clyp/pulls');
    const el = document.getElementById('prs-list');
    el.classList.remove('loading');
    if (!prs.length) {
        el.innerHTML = '<div class="wh-empty">No open pull requests.</div>';
        return;
    }
    el.innerHTML = prs.slice(0, 8).map(pr => `
        <div class="wh-item">
            <div class="wh-title"><a href="${pr.html_url}" target="_blank">${pr.title}</a></div>
            <div class="wh-meta">By <span>${pr.user.login}</span> &middot; Opened <span>${formatDate(pr.created_at)}</span></div>
            <div class="wh-body">${pr.body ? pr.body.substring(0, 120).replace(/\n/g, ' ') + (pr.body.length > 120 ? '‚Ä¶' : '') : ''}</div>
        </div>
    `).join('');
}

// Initialize everything
document.addEventListener('DOMContentLoaded', function() {
    // Update live stats on load and every 60 seconds
    updateLiveStats();
    setInterval(updateLiveStats, 60000);
    
    // Load what's happening content
    loadReleases();
    loadPRs();
    
    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
});
</script>
{% endblock %}
